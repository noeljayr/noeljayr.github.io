<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>On-point Finance and Business Consultants</title>

    <link rel="stylesheet" href="../css/index.css" />
    <link rel="stylesheet" href="../css/admin.css" />
    <link rel="stylesheet" href="../css/animations.css" />

    <link
      rel="shortcut icon"
      href="../public/logos/favicon.png"
      type="image/x-icon"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />

    <script defer src="js/admin.js"></script>
    <script defer src="js/modals.js"></script>

    <script src="js/jquery.min.js"></script>
  </head>
  <body>
    <div class="content">
      <div class="side-bar"></div>
      <script>
        const page = "Emails & Comments";
      </script>

      <script src="../js/components/sidebar.js"></script>

      <div class="top-bar">
        <a href="dashboard " class="logo">
          <img
            src="../public/logos/logo.png"
            alt="Girl Engineer Logo"
            class="logo-gfx"
          />
          <h1>OPFBC</h1>
        </a>

        <span class="settings">
          <i class="bi bi-person-fill-gear"></i>

          <span class="options">
            <a href="profile?user_id=">Profile</a>
            <a href="includes/logout ">Logout</a>
          </span>
        </span>
      </div>

      <span class="greeting">
        <h1>Comments</h1>
      </span>

      <div
        style="justify-content: unset; gap: 2rem"
        class="section-container quick-action-container"
      >
        <a href="messages.html" class="quick-action">
          <span class="quick-action-title">Messages</span>

          <i class="bi bi-chat-square-text-fill"></i>
          <span class="counter">7</span>
        </a>
      </div>

      <div class="section-container message-container comments-container">
        <h1>Comments</h1>
      </div>

      <form
        style="align-items: center"
        id="delete-comment-form"
        class="modal-form form"
      >
        <p>Are you sure you want to delete a comment by <b></b></p>

        <input
          hidden
          name="delete-comment-id"
          id="delete-comment-id"
          type="text"
        />

        <div class="btn-container">
          <span class="discard-btn btn"> Cancel </span>

          <div class="msg-container success-container">
            <div class="svg ui-success">
              <svg
                viewBox="0 0 87 87"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g id="Group-3" transform="translate(2.000000, 2.000000)">
                    <circle
                      id="Oval-2"
                      stroke="rgba(165, 220, 134, 0.2)"
                      stroke-width="4"
                      cx="41.5"
                      cy="41.5"
                      r="41.5"
                    ></circle>
                    <circle
                      class="ui-success-circle"
                      id="Oval-2"
                      stroke="#A5DC86"
                      stroke-width="4"
                      cx="41.5"
                      cy="41.5"
                      r="41.5"
                    ></circle>
                    <polyline
                      class="ui-success-path"
                      id="Path-2"
                      stroke="#A5DC86"
                      stroke-width="4"
                      points="19 38.8036813 31.1020744 54.8046875 63.299221 28"
                    ></polyline>
                  </g>
                </g>
              </svg>
            </div>

            <span class="msg">Comment Deleted Successfully</span>
          </div>

          <div class="msg-container error-container">
            <div class="svg ui-error">
              <svg
                viewBox="0 0 87 87"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g id="Group-2" transform="translate(2.000000, 2.000000)">
                    <circle
                      id="Oval-2"
                      stroke="rgba(252, 191, 191, .5)"
                      stroke-width="4"
                      cx="41.5"
                      cy="41.5"
                      r="41.5"
                    ></circle>
                    <circle
                      class="ui-error-circle"
                      stroke="#F74444"
                      stroke-width="4"
                      cx="41.5"
                      cy="41.5"
                      r="41.5"
                    ></circle>
                    <path
                      class="ui-error-line1"
                      d="M22.244224,22 L60.4279902,60.1837662"
                      id="Line"
                      stroke="#F74444"
                      stroke-width="3"
                      stroke-linecap="square"
                    ></path>
                    <path
                      class="ui-error-line2"
                      d="M60.755776,21 L23.244224,59.8443492"
                      id="Line"
                      stroke="#F74444"
                      stroke-width="3"
                      stroke-linecap="square"
                    ></path>
                  </g>
                </g>
              </svg>
            </div>

            <span class="msg">Something went wrong</span>
          </div>

          <button style="background-color: red" class="btn" type="submit">
            <span class="add">Delete</span>
            <span class="wait">Please Wait...</span>
          </button>
        </div>
      </form>
    </div>

    <form hidden id="approve-form">
      <input name="approve-id" type="text" />
      <button type="submit"></button>
    </form>

    <form hidden id="disapprove-form">
      <input name="disapprove-id" type="text" />
      <button type="submit"></button>
    </form>

    <div class="modal-overlay"></div>

    <script src="../js/comments.js"></script>
    <script>
      const commentsContainer = document.querySelector(".comments-container");

      function displayComments() {
        comments.forEach((m) => {
          var message = document.createElement("div");
          message.className = "message";
          message.id = m.id;

          if (m.status == "Approved") {
            statusBtn =
              statusBtn = `<span onclick="approveComment(this)" style="background-color: green;" class="cta">
                                <i class="bi bi-check-circle-fill"></i>
                                Approved
                           </span> `;
          } else {
            statusBtn = `<span onclick="disapproveComment(this)" style="background-color: purple;" class="cta">
                              <i class="bi bi-x-circle-fill"></i> 
                              Disapproved
                         </span> `;

            message.classList.add("disapproved");
          }

          var picImg;

          if(m.img == "" || m.img == null){
            picImg = "default.svg";
            message.classList.add("no-img")
          }else{
            picImg = m.img
          }
          message.innerHTML = `
            <span class="user-img"><img src="../public/images/${picImg}" /></span>
            <span  onclick="showMessage(this.parentElement)" class="name">
              <b>${m.name}</b>
              <span class="user-email">${m.email}</span>
            
            </span>

            <span onclick="showMessage(this.parentElement)" class="cta-2 show-content">
              <img src="../public/icons/tabler-icon-chevron-down.svg" alt="">
            </span>

            <span class="message-content">
             
              <p>
                ${m.content}
              </p>


              <span class="btn-container">
                    ${statusBtn}
                    <span style="background-color: red;" class="cta delete-comment">Delete</span>
              </span>
            </span>
         
          `;

          commentsContainer.appendChild(message);
        });
      }

      var statusBtn;

      displayComments();

      function showMessage(m) {
        // const messageDivs =  document.querySelectorAll(".message")
        // messageDivs.forEach((div)=>{
        //    div.classList.remove("message-active")
        // })
        m.classList.toggle("message-active");
      }

      const approveForm = document.querySelector("#approve-form");
      const disapproveForm = document.querySelector("#disapprove-form");

      function approveComment(btn) {
        var commentId = btn.parentElement.parentElement.parentElement.id;
        approveForm.querySelector("input").value = commentId;

        approveForm.querySelector("button").click();
      }

      function disapproveComment(btn) {
        var commentId = btn.parentElement.parentElement.parentElement.id;
        disapproveForm.querySelector("input").value = commentId;

        disapproveForm.querySelector("button").click();
      }
    </script>
  </body>
</html>
